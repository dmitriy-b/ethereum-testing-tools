name: Run gas benchmarks

on:
  workflow_dispatch:
    inputs:
      runs:
        description: Number of benchmark runs
        required: false
        default: 1

jobs:
  gas-benchmarks:
    runs-on: ubuntu-latest # default runner; override to change VM

    steps:
      - name: Checkout gas-benchmarks repository
        uses: actions/checkout@v4
        with:
          repository: NethermindEth/gas-benchmarks
          ref: feat/gas-benchmark-workflow  # <--- IMPORTANT: Specify the branch/tag you want!
          lfs: true                         # <--- Keeps LFS files correct

      - name: Run gas-benchmarks composite action
        uses: ./.github/actions/gas-benchmark-action  # <--- CHANGED: Use local path
        with:
          # Benchmark configuration (all optional, with sensible defaults)
          testPath: eest_tests
          genesisFile: zkevmgenesis.json
          warmupFile: warmup/warmup-1000bl-16wi-24tx.txt
          clients: nethermind
          runs: ${{ github.event.inputs.runs }}
          opcodeWarmupCount: '1'
          filter: ''
          images: '{"nethermind":"default","geth":"default","reth":"default","erigon":"default","besu":"default","nimbus":"default","ethrex":"default"}'

          # PostgreSQL target (no DB is provisioned by this workflow)
          postgresHost: ''
          postgresPort: '5432'
          postgresDbName: monitoring
          postgresTable: gas_benchmarks_ci

          # DB credentials passed from your repository secrets
          postgresUser: ${{ secrets.PERFNET_DB_USER }}
          postgresPassword: ${{ secrets.PERFNET_DB_PASSWORD }}
